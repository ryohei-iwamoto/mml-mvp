# 卒論引継ぎ: MML-MVP 今後の課題

## 現状のまとめ

本システム（MML-MVP）は、手描きのラフスケッチから機械部品の設計データを作るツールである。

やっていることを簡単に言うと:
1. ラフなスケッチ画像をアップロードする
2. システムが画像から形状（外形、穴、曲げ線）を読み取る
3. AIとの対話で「何を作りたいのか」「どういう条件か」を聞き取る
4. 設計意図を中間データ（MML-JSON）として保存する
5. そこから図面（DXF）、画像（PNG）、3Dモデル（STL）を自動生成する

現在対応している部品は **プレート（板）、ブラケット（L字金具）、歯車、ロボットアーム** の4種類。
ロボットアームは12個の部品（土台、関節、リンク、歯車など）を組み合わせた3Dモデルまで生成できる。

詳細はREADME.mdを参照。

ロボットアームでは「画像アップロード → 部品判定 → 構成要素の洗い出し → 対話 → 図面・3D生成」の一連の流れができているので、今後はこれを他の部品タイプにも広げ、各ステップの精度を上げていく。

---

## 今後やるべきこと

### 1. 機械モデリング言語(MML)に含めるべき要素の検討

**何が問題か:**
このシステムの核にある「機械モデリング言語（MML）」は、設計の意図を記録するための言語である。
CADが「どんな形か」を書くのに対して、MMLは「何のために、どういう条件で作るのか」を書く。
現在91項目の設計意図（用途、動き方、荷重、材料の意図など）を記録できるが、
「ものを作るうえで本当に必要な抽象的な設計情報は何か」がまだ十分に整理されていない。

**考えるべきこと:**
- MMLはあくまで「抽象的な設計」を入れる場所。具体的な寸法はCADの仕事。では何を入れるべきか？
- 例えば「この穴にボルトを通してこの部品と締結する」といった**部品同士の関係**が今は弱い
- 「ぴったり合うべき」→ 実際の公差はいくつか？のような**抽象→具体の変換ルール**が未整備
- 現在の91項目に過不足がないか（使われていない項目はないか、足りない項目はないか）

**現状の問題点:**
- 設計意図の91項目がフラットに並んでいるだけで、「この項目はこの項目に依存する」という関係が表現できない
- 歯車専用の項目（歯数、モジュールなど）はあるが、他の部品タイプ専用の項目がない

### 2. 曲線・形状の認識精度を上げる

**何が問題か:**
現在の画像認識は、直線的な外形と丸い穴の読み取りは得意だが、曲線が多い形状は苦手。
スケッチ画像のなめらかな曲線を直線の集まり（カクカクした形）に近似してしまう。

**改善すべき点:**
- なめらかな曲線をそのまま曲線として認識する（今はカクカクした直線近似）
- 円弧や楕円の形も検出できるようにする
- 角の丸み（フィレット）を認識する
- 丸穴以外の穴（長穴、四角い穴など）にも対応する
- 手書きの汚いスケッチでも正しく読み取れるようにする
- 穴の誤検出（穴でないものを穴と認識してしまう）をさらに減らす

### 3. ロボットアームと歯車以外も作れるようにする

**何が問題か:**
現在作れるのはプレート、ブラケット、歯車、ロボットアームの4種類だけ。
実用的なツールにするには、もっと多くの種類の部品を扱えるようにする必要がある。

**追加候補の例:**
- ケーシング / ハウジング（機械を覆う箱型の外装）
- フレーム構造（L型鋼やチャンネルで組む骨組み）
- カム機構（回転を往復運動に変えるもの）
- プーリー / ベルト伝動（回転を伝えるもの）
- バネ / ダンパー（衝撃を吸収するもの）
- ヒンジ / スライダ（開閉や直線移動をする機構）

### 4. 適切な部品を選び、適切なサイズにする

**何が問題か:**
現在は構成部品をAIが提案するが、条件を満たさない場合は固定のリストで置き換えてしまう。
部品のサイズもAIが「それっぽく」決めているだけで、力学的な根拠がない。

**本来やるべきこと:**
- 要求仕様（荷重、速度、リーチなど）から必要な力やトルクを計算する
- 計算結果に基づいて、適切なモーターやベアリングを選ぶ
- 歯車の大きさや歯の数を、必要な伝達力から決める
- 軸や腕の太さを、強度と軽さのバランスで決める

つまり「見た目だけのモデル」から「力学的に妥当なモデル」にすることが目標。

### 5. 強度計算を入れる

**何が問題か:**
現在は形を作るだけで、「この設計で壊れないか」のチェックがない。

**段階的に進める案:**
1. **まずは簡単なチェックから**
   - 板金が曲がる力に耐えられるか
   - ボルトで締めた部分の面圧は大丈夫か
   - 歯車の歯元が折れないか
   - 軸がねじれで壊れないか

2. **次のステップ**
   - ロボットアームの腕を「梁」として計算し、各関節にかかる力やたわみ量を算出

3. **将来的には**
   - 有限要素法（FEM）による本格的な強度シミュレーション

**MMLとの関係:**
- 設計データに「安全率○倍以上」「許容応力○○MPa以下」などの強度条件を追加する
- 強度計算の結果をレポートに記録する
- 強度が足りないときは「ここを太くした方がいい」と自動で提案する仕組みを作る

### 6. 構成部品のライブラリを充実させる

**何が問題か:**
部品ライブラリ（既製品のデータベース）の枠組みはあるが、登録されている部品が少ない。
実際の設計では「M5のボルト」「6205ベアリング」のように規格品を選んで使うため、
規格品のデータが揃っていないと実用的にならない。

**揃えるべきもの:**
- ボルト・ナット・ワッシャー（M3〜M20、JIS規格の寸法表）
- ベアリング（規格ごとの内径・外径・幅の表）
- 歯車（モジュール0.5〜5、歯数ごとの形状データ）
- モーター（ステッピング、サーボなど、サイズと出力の表）
- 軸（丸棒、キー溝付きなど）
- バネ（圧縮、引張、ねじりバネ）

---

## 既知の問題

| 問題 | 内容 |
|------|------|
| テスト1が失敗する | 部品名が「Unknown」になってしまう不具合がある |
| メインのプログラムが大きすぎる | app.pyが2,378行あり、機能ごとに分割した方が管理しやすい |
| 対話中のデータ保持が不安定 | 画面遷移のたびにデータを受け渡しているので、途中で消える可能性がある |
| AIのエラー通知が不十分 | AI（OpenAI API）の応答が遅い・失敗したときにユーザーへの説明が足りない |

---

## 研究として深められる方向性

- **MML言語仕様の形式化**: 今のJSON形式以外の書き方（専用の記法やグラフ構造）を検討する
- **設計意図の自動推論**: 画像とテキストから「何を作りたいのか」をAIがもっと正確に推定する
- **設計知識ベース**: 過去の設計事例をMMLで蓄積し、似た設計を再利用できるようにする
- **製造可能性の自動評価**: 設計データから「この形は加工できるか」「コストはいくらか」を推定する
- **協調設計**: 複数人で設計意図を共有・統合する仕組み

---
---

# 【簡易版】卒論引継ぎ まとめ

## このシステムは何？

手描きのスケッチをアップロードすると、AIとの対話を経て、図面（DXF）と3Dモデル（STL）を自動で作ってくれるWebアプリ。
「設計の意図」を中間データとして保存するのが特徴で、寸法ではなく「何のために、どう作りたいか」を記録する。

## 今できること

- スケッチ画像から形状を認識（外形、穴、曲げ線）
- AIとの対話で設計条件を聞き取り
- 図面（DXF）、画像（PNG）、3Dモデル（STL）を出力
- 対応部品: プレート、ブラケット、歯車、ロボットアーム（12部品の組立）

## 今後やること（優先度順）

| # | やること | ひとことで言うと |
|---|---------|---------------|
| 1 | MMLに含める要素の検討 | 「設計の意図」として何を記録すべきか整理する |
| 2 | 画像認識の精度向上 | 曲線や複雑な形も正しく読めるようにする |
| 3 | 対応部品を増やす | 歯車とロボットアーム以外も作れるようにする |
| 4 | 適切な部品選定・サイズ決定 | 見た目だけでなく力学的に正しいサイズにする |
| 5 | 強度計算を入れる | 「壊れないか」を自動チェックする |
| 6 | 部品ライブラリを増やす | ボルト、ベアリング等の規格品データを揃える |
